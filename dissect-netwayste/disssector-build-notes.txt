# Need to run this in build.rs before running clang
# See how to launch a process from build.rs
# pkg-config --cflags glib-2.0 wireshark

# Bind-gen needs Clang
libclang1-9 libclang-9-dev libclang-common-9-dev

# Build Wireshark from source. Requires 3.1 or newer
https://kifarunix.com/install-latest-wireshark-on-ubuntu-18-04/
# or build debian binaries for it
https://www.consentfactory.com/install-wireshark-3-0-2-on-ubuntu-desktop-18-04-redux/

# Set network privileages for dumpcap
whereis dumpcap
sudo setcap cap_net_raw,cap_net_admin+eip /path/to/dumpcap

# Create the wireshark personal plugins directory
mkdir -p $HOME/.local/lib/wireshark/plugins/3.2/epan/

# Build the library
cd /path/to/conwayste/dissect-netwayste/
# Ensure the version of wireshark is specified in `lib.rs`
# Specify the path to wireshark
cargo build

# Copy the lib over
cp ../target/debug/libdissect_netwayste.so $HOME/.local/lib/wireshark/plugins/3.2/epan/conwayste.so

# Run Wireshark
wireshark